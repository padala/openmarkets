<h1>ODesk Test Page</h1>

<p class="lead">Instructions</p>

<ul>
    <li><a href="https://edgarsubmissions.firebaseio.com/.json">Source JSON Data</a> 
    </li>
    <li><a href="http://www.highcharts.com/demo/column-basic">Example of column chart</a>
    </li>
    <li>Highcharts is already in the asset pipeline.</li>
    <li>Using Source JSON Data above, create a dynamic column chart showing the number of filings by date.</li>
    <li>X axis: date (field: signatureDate)</li>
    <li>Y axis: number of filings (field: edgarSubmission => each edgarSubmission is a "filing")</li>
    <li><strong>Comment code with good documentation</strong>
    </li>
</ul>

<!-- Insert chart here in div#container -->
<div id="container" style="min-width: 310px; height: 400px; margin: 0 auto">
</div>

<!-- Insert script below -->
<script>
    $(document).ready(function () {

        //Returns the weekNumber for a given date
        Date.prototype.getWeekNumber = function () {
            var d = new Date(+this);
            d.setHours(0, 0, 0);
            d.setDate(d.getDate() + 4 - (d.getDay() || 7));
            return Math.ceil((((d - new Date(d.getFullYear(), 0, 1)) / 8.64e7) + 1) / 7);
        };

        $.getJSON("https://edgarsubmissions.firebaseio.com/.json", function (data) {
            //Preprocessing - Grouping filings for a particular iso week in a year.
            var processedData = _.groupBy(data.submissions, function (submission) {
                try {
                    var date = new Date(submission.edgarSubmission.offeringData.signatureBlock.signatureDate);
                    return date.getFullYear() + '' + date.getWeekNumber();
                } catch (e) {
                    console.log("signatureDate is missing for submission: ", submission);
                    return ;
                }
            });

            //Converting data into HighChart - Column data format
            var chartData = _.map(processedData, function (item) {
                try {
                    return [new Date(item[0].edgarSubmission.offeringData.signatureBlock.signatureDate).getTime(), item.length];
                } catch (e) {
                    console.log("signatureDate is missing");
                }
            });

            //Rendering chart with processedData
            renderChart(chartData);
        });

        //Method to renderChart for Given Data
        function renderChart(data) {
            $('#container').highcharts({
                chart: {
                    type: 'column'
                },
                title: {
                    text: 'Number of fillings by Week'
                },
                xAxis: {
                    type: 'datetime',
                    labels: {
                        rotation: -45,
                        style: {
                            fontSize: '13px',
                            fontFamily: 'Verdana, sans-serif'
                        }
                    }
                },
                yAxis: {
                    title: {
                        text: 'Number of Filings'
                    }
                },
                legend: {
                    enabled: false
                },
                series: [{
                    name: 'Filings',
                    data: data
                }]
            });
        }
    });
</script>
